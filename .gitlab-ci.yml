image: node:8.12.0
stages:
  - tests
  - deploy
  - production

version:
  stage: tests
  script:
  - node --version
  - whoami
  only:
  - dev
  - master

run_tests:
  stage: tests
  script:
  - npm install
  - npm test
  only:
  - dev
  - master

deploy_staging_dev:
  stage: deploy
  script:
  - git remote add heroku https://heroku:$HEROKU_API_KEY@git.heroku.com/fjs-web.git
  - git push heroku dev:master
  - echo "Deployed to staging server"
  only:
  - dev

production_deploy:
  stage: production
  script:
  - git remote add dokku dokku@migserv.ucc.edu.ar:fjsappadm
  - git push dokku master
  - echo "ðŸ”¥ Deployed to PRODUCTION ðŸ”¥"
  only:
  - master
